generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ProductType {
  PRODUCT
  INGREDIENT
  DECOR
  UTILITY
}

enum PaymentMethod {
  CASH
  CARD
  TRANSFER
}

model Unit {
  id        String    @id @default(cuid())
  name      String
  short     String

  products  Product[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@unique([name, short])
}

model ProductCategory {
  id        String   @id @default(cuid())
  name      String   @unique

  products  Product[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ExpenseCategory {
  id        String   @id @default(cuid())
  name      String   @unique

  expenses  Expense[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Product {
  id         String      @id @default(cuid())
  name       String
  type       ProductType
  price      Int?
  active     Boolean     @default(true)

  categoryId String
  unitId     String

  category   ProductCategory @relation(fields: [categoryId], references: [id], onDelete: Restrict)
  unit       Unit            @relation(fields: [unitId], references: [id], onDelete: Restrict)

  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt

  @@index([type])
  @@index([active])
  @@index([categoryId])
  @@index([unitId])
}

model Expense {
  id            String        @id @default(cuid())

  // Frontend YYYY-MM-DD yuboradi => timezone muammosi boâ€˜lmasin deb String saqlaymiz
  date          String        @db.VarChar(10)

  amount        Int
  paymentMethod PaymentMethod
  note          String?

  categoryId    String
  category      ExpenseCategory @relation(fields: [categoryId], references: [id], onDelete: Restrict)

  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  @@index([date])
  @@index([categoryId])
  @@index([paymentMethod])
}
